<!DOCTYPE html>
<head>
    <title>IoT Web Server</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1" /> 
</head>

<body>
    <div class='section'>
        <div class='labelSection'>
            <div class='label'>Свет на улице</div>
            <div class='status' id='switch1Status'>(Выключится через 15 мин)</div>
        </div>
        <div class='buttonSection'>
            <label class="switchButton" for='myCheckbox1'>
                <input type="checkbox" id='myCheckbox1'>
                <div class="slider round"></div>
            </label>
        </div>
    </div>

    <div class='section'>
        <div class='labelSection'>
            <div class='label'>Неподсоединенный выключатель</div>
            <div class='status' id='switch2Status'>(Выключен)</div>
        </div>
         <div class='buttonSection'>
             <label class="switchButton" for='myCheckbox2'>
                <input type="checkbox" id='myCheckbox2'>
                <div class="slider round"></div>
            </label>
        </div>
    </div>

    
    <script>
        var myCheckbox1 = document.getElementById('myCheckbox1');
        myCheckbox1.addEventListener('change', function(evt) {
            sendRequestToSwitch(0, myCheckbox1.checked);
        });

        var myCheckbox2 = document.getElementById('myCheckbox2');
        myCheckbox2.addEventListener('change', function(evt) {
            sendRequestToSwitch(1, myCheckbox2.checked);
        });
        
        httpGetAsync("/api/getSwitchState", function(json) {
            var data = JSON.parse(json);
            myCheckbox1.checked = (data[0] == 1);
            myCheckbox2.checked = (data[1] == 1);
        });

        // functions
        
        function sendRequestToSwitch(index, state) {
            var req = new XMLHttpRequest();
            var url = "/api/setSwitchState";
            var params = JSON.stringify({switch:index, state:state});
//            var username = 'user';
//            var password = 'password';
            req.open("POST", url, true/*, username, password*/); // -> http://user:pass@galileo:8080/...
//            req.setRequestHeader("Authorization", "Basic " + btoa(username + ":" + password));  // encode string to Base64      
            req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                
            req.send(params);
        }
        
        function httpGetAsync(theUrl, callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function() { 
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                    callback(xmlHttp.responseText);
            }
            xmlHttp.open("GET", theUrl, true); // true for asynchronous 
            xmlHttp.send(null);
        }
        
    </script>
</body>
